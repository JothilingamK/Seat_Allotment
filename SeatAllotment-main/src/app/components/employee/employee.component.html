<div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <img src="assets/finzly.svg" alt="logo" height="50px"><br>
        <button [routerLink]="'/'" [class.active]="selectedMenu === 'home'" class="sidebar-btn">
            <i class="bi bi-house-door"></i>
            Home
        </button>
        <button (click)="setMenu('manageEmployee')" [class.active]="selectedMenu === 'manageEmployee'" class="sidebar-btn">
            <i class="bi bi-people"></i>
            Manage Employee
        </button>
    </div>

    <!-- Main Content -->
    <div class="content">

        <!-- Employee Stats Section -->
        <div class="stats-container">
            <div class="stat-card total">
                <div class="stat-icon">
                    <i class="bi bi-people-fill"></i>
                </div>
                <div class="stat-content">
                    <h4>TOTAL EMPLOYEES</h4>
                    <p>{{ employees.length }}</p>
                </div>
            </div>
            <div class="stat-card unassigned">
                <div class="stat-icon">
                    <i class="bi bi-person-x-fill"></i>
                </div>
                <div class="stat-content">
                    <h4>UNASSIGNED</h4>
                    <p>{{ getUnassignedCount() }}</p>
                </div>
            </div>
            <div class="stat-card wfh">
                <div class="stat-icon">
                    <i class="bi bi-house-fill"></i>
                </div>
                <div class="stat-content">
                    <h4>WORK FROM HOME</h4>
                    <p>{{ getWFHCount() }}</p>
                </div>
            </div>
            <div class="stat-card allocated">
                <div class="stat-icon">
                    <i class="bi bi-check-circle-fill"></i>
                </div>
                <div class="stat-content">
                    <h4>ALLOCATED</h4>
                    <p>{{ getAllocatedCount() }}</p>
                </div>
            </div>
        </div>



        <!-- Configuration Section -->
        <div *ngIf="selectedMenu === 'configuration'">
            <h3>Seating Configuration</h3>
            <p>Configure the seating layout and assign desks to employees.</p>
        </div>

        <!-- Manage Employees Section -->
        <div *ngIf="selectedMenu === 'manageEmployee'" class="employee-container">
            <!-- Search Bar & Action Buttons -->
            <div class="action-bar">
                <div class="search-container">
                    <i class="bi bi-search search-icon"></i>
                    <input type="text" [(ngModel)]="searchQuery" (ngModelChange)="onSearchChange()" 
                           placeholder="Search employees..." class="search-input">
                </div>
                <div class="action-buttons">
                    <button class="action-btn primary" (click)="showModal = true">
                        <i class="bi bi-person-plus"></i> Add Employee
                    </button>
                    <button class="action-btn bulk-upload" (click)="showBulkUploadModal = true">
                        <i class="bi bi-cloud-upload"></i> Bulk Upload
                    </button>
                    <button class="action-btn secondary" (click)="generateReport()">
                        <i class="bi bi-file-earmark-pdf"></i> Generate PDF
                    </button>
                    <button class="action-btn secondary" (click)="generateReportExcel()">
                        <i class="bi bi-file-earmark-excel"></i> Generate Excel
                    </button>
                </div>
            </div>


            <!-- Employee Table -->
            <div class="table-container">
                <table class="employee-table">
                    <thead>
                        <tr>
                            <th>EMPLOYEE ID</th>
                            <th>NAME</th>
                            <th>DEPARTMENT</th>
                            <th>ROLE</th>
                            <th>SEAT NO</th>
                            <th>EDIT</th>
                            <th>ACTIONS</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let employee of paginatedEmployees" class="table-row">
                            <td class="employee-id">{{ employee.employeeid }}</td>
                            <td class="employee-name">{{ employee.name }}</td>
                            <td class="employee-dept">{{ employee.department }}</td>
                            <td class="employee-role">{{ employee.role || '-' }}</td>
                            <td class="employee-seat">
                                <span class="seat-badge" [ngClass]="getSeatStatusClass(employee.seat_id)">
                                    {{ employee.seat_id || 'Unassigned' }}
                                </span>
                            </td>
                            <td class="action-cell">
                                <button (click)="editEmployee(employee)" class="action-btn edit" title="Edit Employee">
                                    <i class="bi bi-pencil-square"></i>
                                </button>
                            </td>
                            <td class="action-cell">
                                <button (click)="removeEmployee(employee.employeeid)" class="action-btn delete" title="Delete Employee">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination Controls -->
            <div class="pagination-controls">
                <button class="pagination-btn" (click)="prevPage()" [disabled]="currentPage === 1">
                    <i class="bi bi-chevron-left"></i> Previous
                </button>
                <div class="pagination-info">
                    <span>Page {{ currentPage }} of {{ totalPages() }}</span>
                </div>
                <button class="pagination-btn" (click)="nextPage()" [disabled]="currentPage >= totalPages()">
                    Next <i class="bi bi-chevron-right"></i>
                </button>
            </div>
        </div>

        

         <div class="modal" *ngIf="showModal">
            <div class="modal-content">
                <h2>Add New Employee</h2>

                <div class="form-group">
                    <label>Employee ID:</label>
                    <input [(ngModel)]="newEmployee.employeeid"   class="form-control"required />
                </div>
                <div class="form-group">
                    <label>Name</label>
                    <input [(ngModel)]="newEmployee.name" class="form-control">
                </div>

                <div class="form-group">
                    <label>Department</label>
                    <input [(ngModel)]="newEmployee.department" class="form-control">
                </div>

                <div class="form-group">
                    <label>Role</label>
                    <input [(ngModel)]="newEmployee.role" class="form-control">
                </div>

                <!-- <div class="form-group">
                    <label>Seat No</label>
                    <input [(ngModel)]="newEmployee.seat_id" class="form-control">
                </div> -->

                <div class="form-group seat-selection">
                    <label>Seat No</label>
                    <select [(ngModel)]="newEmployee.seat_id" (change)="handleNewSeatSelection()" class="form-control">
                        <option value="Work From Home">Work From Home</option>
                        <option value="Unassigned">Unassigned</option>
                        <option value="Manual">Manual Entry</option>
                    </select>
                    <!-- Seat selection dropdown -->
                    <select *ngIf="newEmployee.seat_id === 'Manual' && vacantSeats.length > 0"
                        [(ngModel)]="manualNewSeatEntry"
                        class="form-control">
                    <option *ngFor="let seat of vacantSeats" [value]="seat">{{ seat }}</option>
                    </select>

                    <!-- Manual seat input (if no vacant seats are available) -->
                    <input *ngIf="newEmployee.seat_id === 'Manual' && vacantSeats.length === 0"
                    [(ngModel)]="manualNewSeatEntry"
                    class="form-control"
                    placeholder="Enter Seat No">

                    <!-- Message when no vacant seats are available -->
                    <p *ngIf="newEmployee.seat_id === 'Manual' && vacantSeats.length === 0">
                    No vacant seats available. Enter seat manually.
                    </p>

                </div>
                

                <div class="modal-buttons">
                    <button class="submit-btn" (click)="addEmployee()">Submit</button>
                    <button class="close-btn" (click)="showModal = false">Close</button>
                </div>
            </div>
        </div>

<!-- Modal for Editing Employee -->
        <div class="modal" *ngIf="showEditModal">
            <div class="modal-content">
                <h2>Edit Employee</h2>

                <div class="form-group">
                    <label>Name</label>
                    <input [(ngModel)]="selectedEmployee.name" class="form-control">
                </div>

                <div class="form-group">
                    <label>Department</label>
                    <input [(ngModel)]="selectedEmployee.department" class="form-control">
                </div>

                <div class="form-group">
                    <label>Role</label>
                    <input [(ngModel)]="selectedEmployee.role" class="form-control">
                </div>

                <!-- Seat Selection -->
                <div class="form-group seat-selection">
                    <label>Seat No</label>
                    <select [(ngModel)]="selectedEmployee.seat_id" (change)="handleSeatSelection()" class="form-control">
                        <option value="Work From Home">Work From Home</option>
                        <option value="Unassigned">Unassigned</option>
                        <option value="Manual">Manual Entry</option>
                    </select>

                    <!-- Dropdown for vacant seats -->
                    <select *ngIf="selectedEmployee.seat_id === 'Manual' && vacantSeats.length > 0"
                            [(ngModel)]="manualSeatEntry"
                            class="form-control">
                        <option *ngFor="let seat of vacantSeats" [value]="seat">{{ seat }}</option>
                    </select>

                    <!-- Input field for manual seat entry -->
                    <input *ngIf="selectedEmployee.seat_id === 'Manual' && vacantSeats.length === 0"
                        [(ngModel)]="manualSeatEntry"
                        class="form-control"
                        placeholder="Enter Seat No">

                    <!-- Message when no vacant seats are available -->
                    <p *ngIf="selectedEmployee.seat_id === 'Manual' && vacantSeats.length === 0">
                        No vacant seats available. Enter seat manually.
                    </p>
                </div>

                <div class="modal-buttons">
                    <button class="submit-btn" (click)="updateSeat()">Update</button>
                    <button class="close-btn" (click)="showEditModal = false">Close</button>
                </div>

            </div> <!-- This properly closes modal-content -->
        </div> <!-- This properly closes modal -->

        <!-- Confirmation Popup -->
        <div *ngIf="showConfirmation" class="confirmation-popup">
            Employee Added Successfully!
        </div>

        <!-- Bulk Upload Modal -->
        <div class="modal" *ngIf="showBulkUploadModal">
            <div class="modal-content bulk-upload-modal">
                <h2>Bulk Upload Employees</h2>
                
                <div class="upload-section">
                    <div class="file-drop-zone" 
                         (dragover)="onDragOver($event)" 
                         (dragleave)="onDragLeave($event)" 
                         (drop)="onFileDrop($event)"
                         [class.drag-over]="isDragOver">
                        <div class="drop-zone-content">
                            <i class="bi bi-cloud-upload upload-icon"></i>
                            <p class="upload-text">Drag & drop your Excel file here</p>
                            <p class="upload-subtext">or</p>
                            <input type="file" 
                                   #fileInput 
                                   (change)="onFileSelect($event)" 
                                   accept=".xlsx,.xls" 
                                   class="file-input">
                            <button class="browse-btn" (click)="fileInput.click()">
                                Browse Files
                            </button>
                        </div>
                    </div>
                    
                    <div *ngIf="selectedFile" class="selected-file">
                        <div class="file-info">
                            <i class="bi bi-file-earmark-excel file-icon"></i>
                            <div class="file-details">
                                <p class="file-name">{{ selectedFile.name }}</p>
                                <p class="file-size">{{ formatFileSize(selectedFile.size) }}</p>
                            </div>
                            <button class="remove-file-btn" (click)="removeSelectedFile()">
                                <i class="bi bi-x"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="upload-instructions">
                    <div class="instructions-header">
                        <h4>Instructions:</h4>
                        <button class="template-btn" (click)="downloadTemplate()">
                            <i class="bi bi-download"></i> Download Template
                        </button>
                    </div>
                    <ul>
                        <li>Excel file should contain columns: Employee ID, Name, Department, Role, Seat No</li>
                        <li>First row should be headers</li>
                        <li>Supported formats: .xlsx, .xls</li>
                        <li>Maximum file size: 10MB</li>
                    </ul>
                </div>

                <div class="modal-buttons">
                    <button class="submit-btn" 
                            (click)="processBulkUpload()" 
                            [disabled]="!selectedFile || isUploading">
                        <i class="bi bi-upload" *ngIf="!isUploading"></i>
                        <i class="bi bi-hourglass-split" *ngIf="isUploading"></i>
                        {{ isUploading ? 'Processing...' : 'Upload & Process' }}
                    </button>
                    <button class="close-btn" (click)="closeBulkUploadModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal" *ngIf="showDeleteModal">
            <div class="modal-content delete-confirmation-modal">
                <div class="delete-header">
                    <div class="delete-icon">
                        <i class="bi bi-exclamation-triangle"></i>
                    </div>
                    <h2>Confirm Employee Deletion</h2>
                </div>
                
                <div class="delete-content">
                    <p class="delete-warning">Are you sure you want to delete this employee? This action cannot be undone.</p>
                    
                    <div class="employee-details" *ngIf="employeeToDelete">
                        <div class="detail-row">
                            <span class="label">Employee ID:</span>
                            <span class="value">{{ employeeToDelete.employeeid }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Name:</span>
                            <span class="value">{{ employeeToDelete.name }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Department:</span>
                            <span class="value">{{ employeeToDelete.department }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Role:</span>
                            <span class="value">{{ employeeToDelete.role || 'Not specified' }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Seat:</span>
                            <span class="value">{{ employeeToDelete.seat_id || 'Unassigned' }}</span>
                        </div>
                    </div>
                </div>

                <div class="modal-buttons">
                    <button class="cancel-btn" (click)="cancelDelete()">
                        <i class="bi bi-x-circle"></i> Cancel
                    </button>
                    <button class="delete-confirm-btn" (click)="confirmDelete()" [disabled]="isDeleting">
                        <i class="bi bi-trash" *ngIf="!isDeleting"></i>
                        <i class="bi bi-hourglass-split" *ngIf="isDeleting"></i>
                        {{ isDeleting ? 'Deleting...' : 'Delete Employee' }}
                    </button>
                </div>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div class="toast-container">
            <div *ngIf="showSuccessToast" class="toast toast-success">
                <i class="bi bi-check-circle"></i>
                <span>{{ successMessage }}</span>
                <button class="toast-close" (click)="hideSuccessToast()">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            
            <div *ngIf="showWarningToast" class="toast toast-warning">
                <i class="bi bi-exclamation-triangle"></i>
                <span>{{ warningMessage }}</span>
                <button class="toast-close" (click)="hideWarningToast()">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            
            <div *ngIf="showErrorToast" class="toast toast-error">
                <i class="bi bi-x-circle"></i>
                <span>{{ errorMessage }}</span>
                <button class="toast-close" (click)="hideErrorToast()">
                    <i class="bi bi-x"></i>
                </button>
            </div>
        </div>

       
    </div>
</div>
